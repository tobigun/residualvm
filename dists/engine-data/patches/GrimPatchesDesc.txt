List of fixed bugs in GF scripts:

+Various bugs
	-Issues with CD check:
	The CD check function doesn't work correctly, so we skip it.

	-Fix the behaviour of dofile statement
	In _system.lua there is a re-definition of dofile, used to load
	scripts from some others positions ("Scripts\" and "d:\\grimFandango\\Scripts\\").
	This cause a lot of warnings when an non-existent file is required.
	Moreover this function is bugged: it always returns nil, even if the
	file has correctly loaded. So it's has been modified to load scripts
	only from the main path and it returns nil when the file has
	successfully loaded, otherwise the number one (which is a boolean
	true). The last modification is required, since the others scripts
	expect this behavior.

	-Fix bug #312 "Manny disappears while holding and examining the sign the Ruba."
	In sg and na sets, if Manny examine the sign of Ruba, it zoom the
	visual near the sign, by changing the setup and putting Manny and the
	sign in it. The code that translate the coordinates of Manny is
	bugged, since it doesn't distinguish the case when the sign is
	planted or not; in particular, it's right when it's planted. This
	patch add a check of state of sign, and set Manny in a fixed position
	(in the centre of the scene) when he is holding the sign. It also
	corrects the behaviour of Manny's head, since he doesn't look at the
	sign, when he is examining it. This is caused by the lacks of
	"enable_head_control(FALSE/TRUE)" before and after
	"START/END_CUT_SCENE()" and by a call at "manny:head_look_at_point"
	with the wrong arguments (a table instead of the coordinates instead
	of single coordinates).

	-Fix bug #397 "Keyboard jams in inventory in beaver dam."
	The function bd.fake_beaver animates a beaver when another one has jumped
	into the dam. This animation is performed into a cutscene block (between
	START/END_CUT_SCENE()), so if the user opens the inventory a bit before
	this function is called, the interface will froze, since in
	cutscenes the keyboard is locked. This patch check if the inventory is open
	(with inInventorySet()) before bd.fake_beaver and MakeSectorActive
	are called (in bd.throw_bone_in_tar) and wait until it's closed,
	then performs the animation.

	-Fix bug #539 "Early access to Domino's office" - ha.lua.patchr
	ha.enter() locks the door ha.do_door, which goes to Dom's office if Bruno was
	reaped but not Meche, but locking the door isn't enough. It must be explicitly
	closed - calling ha.do_door:close() - otherwise manny will just pass through it.
	As Manny shows, you can lock an open door, and while it is simbolically compelling,
	it doesn't close it. :)

	-Fix bug #672 "Meche's line "I'm sorry I let you down Manny" is played as Manny
	walks into the hallway." - mo.lua.patchr
	mo.ha_door.walkOut doesn't wait for Meche has finished speaking to move Manny outside
	his office. This patch adds a wait_for_message() to prevent this.

	-Fix bug #687 "GRIM: Getting down the conveyour-belt is very difficult." - cy.lua.patchr
	The function cy.climb_chain_box.walkOut checks if the chain is down and makes manny float
	if it is. But the chain may be down but not on the belt if the direction of movement
	of it is from the sea to the crane. This patch adds that missing check.

	-Fix bug #688 "GRIM: If Charlie removes sheet while in inventory, Manny gets stuck" - ly.lua.patchr
	The function ly.charlie_get_up_timer checks if the game is playing a cutscene,
	before launching the scene when Charlie removes the sheet, but it doesn't check if
	the inventory is open. This patch adds another check (with inInventorySet()) and waits
	the close of the inventory before starting the cutscene.

	-Fix bug #81 "Year 1 - Bone disappears from spider web - Glitch" - sp.lua.patchr
	In the sp set, the variable sp.web.has_bone is used to signal if there is a bone in the web,
	but it's not cleaned after that the Glottis' hearts has been launched.
	This patch set this variable to FALSE after that event (in the function sp.manny_hook_n_fling_web)

	-Fix the disappearing hat when opening the inventory with the nautical suit. -
		_inventory.lua.patchr
	The function open_inventory() stops the chore 'manny.hold_chore'. But that variable sometimes
	is nil, and that causes all the chores to be stopped, included the chore which shows the hat.
	This patch checks if 'manny.hold_chore' is not nil and only in that cases it stops it.
	In addition to this now we must also stop the chore 'ms_putback_deck' of ms.cos when putting back
	the cards deck, since that chore before this patch is stopped by stopping 'manny.hold_chore', being
	it nil. Not stopping it results in broken animation when getting the card from the deck.

	-Fix a Lua error when speaking to Lupe with all the dialog options expired (#198) - dlg_lupe.lua.patchr
	When there are no more dialog options the dialog system calls a 'abort' line (Dialog.display_lines,
	in _dialog.lua) which should end the dialog, by setting the value of the 'node' variable to "exit_dialog".
	The other way of ending a dialog is to choose an exit line which is not an abort line but which
	also sets that variable.
	The line 'lu1.aborts.lun1' was making the dialog system call the exit line, instead of just calling
	the say_line() needed, and that in turn resulted in the function Dialog.display_lines be called two
	times with the node set as 'exit_dialog', and so the outro (lu1.outro) was called two times.
	More importantly the function 'start_script(lupe.new_run_idle, lupe, "jump_back")' was called two times,
	and that resulted in broken animation the next time Manny talked to Lupe.
	This patch modifies 'lu1.aborts.lun1', by not relying on the exit line anymore.

	Fix bug #237 "GRIM: The animation of when glottis gives manny the work order does not play correctly."
		- dlg_glottis.lua.patchr
	gl1[220].response calls the function 'glottis.hand_work_order', which manages the animation and then
	calls 'glottis:flip_ears(5)' after a 'wait_for_message()'. The flip_ears() call causes the chore
	'default_keys' of 'gl_akimbo_idles.cos' to be completed (Chore::setLastFrame), and that stops any
	keyframe component that costume has, including 'give_workorder.key'. This patch moves the flip_ears()
	call before the wait_for_message(), so that 'default_keys' is completed before 'give_workorder.key' starts.

+Untriggered contents:
	-Fix the missing dialogue with Domino at third year
	In dlg_dom2.lua, the argument of CheckFirstTime is wrong; this
	prevents the correct load of this script.
	See http://forums.residualvm.org/viewtopic.php?t=108

+Others modifications:
	-The function si.set_up_actors (si.lua), calls "start_script(si.naranja_drinking)",
	which doesn't exist. The problem with that is that lua_error ends the function that
	was going on, breaking si.set really badly. The bad call is replaced with the correct one.

Contents of residualvm-grim-patches.lab and its rebuild:

residualvm-grim-patches.lab contains all .patchr files in the
dists/engine-data/patches/grim/ directory.
If you add a new patch in that directory, you have to update this file
with a detailed description of what that patch does.
Then you have to rebuild residualvm-grim-patches.lab with mklab from the
residualvm-tools repo. The rebuild command is (assuming that you are
launching it in dists/engine-data/):

 $ mklab --grim patches/grim residualvm-grim-patch.lab

Please check that there aren't any files different from .patchr inside
that directory before the rebuild, so delete all junk, backup and system
files, like namepatch.patchr~, namepatch.patchr.bak, .DS_Store, Thumbs.db
and so on.
